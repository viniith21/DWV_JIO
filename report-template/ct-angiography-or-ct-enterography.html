<!DOCTYPE html>
<html>
    <head>
        <title>CT Angiography or CT Enterography - GI Bleed</title>
        <meta charset="UTF-8" />
        <meta name="dcterms.identifier" content="f14eeaa4-55de-4b38-87c8-1cb9f8ac324b" />
        <meta name="dcterms.title" content="CT Angiography or CT Enterography - GI Bleed" />
        <meta name="dcterms.description" content="" />
        <meta name="dcterms.type" content="IMAGE_REPORT_TEMPLATE" />
        <meta name="dcterms.language" content="en" />
        <meta name="dcterms.publisher" content="SAR GI Bleeding Disease-Focused Panel" />
        <meta name="dcterms.rights" content="May be used freely, subject to license agreement" />
        <meta name="dcterms.license" content="http://www.radreport.org/license.pdf" />
        <meta name="dcterms.date" content="2021-09-27" />
        <meta name="dcterms.creator" content="Flavius F. Guglielmo, MD" />
        <script src="Report_Timestamp.js"></script>
        <script type="text/xml">
            <template_attributes>
                <coded_content>
                    <coding_schemes>
                        <coding_scheme name="RADLEX" designator="2.16.840.1.113883.6.256"></coding_scheme>
                        <coding_scheme name="LOINC" designator="2.16.840.1.113883.6.1"></coding_scheme>
                    </coding_schemes>
                    <entry origtxt="TEXT_1572484216324">
                        <term>
                            <code meaning="observations section" value="http://radlex.org/RID/RID28486" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="findings">
                        <term>
                            <code meaning="Procedure Findings" value="59776-5" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216321">
                        <term>
                            <code meaning="imaging technique descriptor" value="http://radlex.org/RID/RID28642" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216321_0">
                        <term>
                            <code meaning="angiography" value="http://radlex.org/RID/RID10371" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216321_1">
                        <term>
                            <code meaning="dynamic contrast-enhanced magnetic resonance imaging" value="http://radlex.org/RID/RID49531" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="clinicalInformationText">
                        <term>
                            <code meaning="clinical information section" value="http://radlex.org/RID/RID13166" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="procedureInformation">
                        <term>
                            <code meaning="Current Imaging Procedure Description" value="55111-9" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216316">
                        <term>
                            <code meaning="imaging procedure" value="http://radlex.org/RID/RID13060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216316_0">
                        <term>
                            <code meaning="angiography" value="http://radlex.org/RID/RID10371" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1572484216316_1">
                        <term>
                            <code meaning="enterography" value="http://radlex.org/RID/RID28549" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="comparisons">
                        <term>
                            <code meaning="Radiology Comparison Study" value="18834-2" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="impression">
                        <term>
                            <code meaning="Impressions" value="19005-8" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1631631997888">
                        <term>
                            <code meaning="observations section" value="http://radlex.org/RID/RID28486" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1572227404910">
                        <term>
                            <code meaning="oral contrast" value="http://radlex.org/RID/RID35817" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1572227404909">
                        <term>
                            <code meaning="intravenous contrast" value="http://radlex.org/RID/RID49553" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1626355957006">
                        <term>
                            <code meaning="GI-bleed" value="http://radlex.org/RID/RID43369" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1626355957008">
                        <term>
                            <code meaning="intraluminal" value="http://radlex.org/RID/RID11135" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1626355957007">
                        <term>
                            <code meaning="location" value="http://radlex.org/RID/RID39038" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="comparisonsText">
                        <term>
                            <code meaning="most recent comparison" value="http://radlex.org/RID/RID50133" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="clinicalInformation">
                        <term>
                            <code meaning="Clinical Information" value="55752-0" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="TEXT_1631631997887">
                        <term>
                            <code meaning="impression" value="http://radlex.org/RID/RID49895" scheme="RADLEX"></code>
                        </term>
                    </entry>
                </coded_content>
            </template_attributes>
        </script>
        <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" rel="stylesheet">

	
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous">
</script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
	
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous"> -->
</script>

<style>
    textarea {
        width: -webkit-fill-available;
    }
    #form-print{
    width: 80%;
    padding: 11px;
    background-color: #7e7e7e59;
    border: 2px solid darkgray;
    margin-right: auto;
    margin: auto;
    }
    .titleH3{
        padding: 10px;
        text-align: center;
        text-decoration-line: underline;
    }

    label {
        font-weight: 600;
    }

    
</style>

</head>
    <body>

        <script>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            let FirebasePath = urlParams.get('path');
            const doctorName = urlParams.get("DoctorName");
          
            const pathArray = FirebasePath.split('/');
            const patient = pathArray[pathArray.length - 2];   
            const patientParts = patient.split('-').map(part => part.trim());
            let formattedPatientName;
          
            // More robust check for repeated "Patient" parts
            if (patientParts.length > 2 && patientParts[0].toLowerCase() === "patient" && patientParts[1].toLowerCase() === "patient") {
              // If 'Patient' is repeated, format as "Patient - [Last Part]"
              formattedPatientName = patientParts.slice(2).join(' - ');
            } else {
              // Use the name after "Patient -", or the full name if the condition doesn't match
              formattedPatientName = patientParts.slice(1).join(' - ');
            }
          
            console.log("Formatted patient name ---", formattedPatientName); 
          
            // Set the formatted name to the input element once the DOM is fully loaded
            document.addEventListener("DOMContentLoaded", function() {
              const inputElement = document.querySelector('input[type="text"]');
              if(inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
              }
            });
          </script>
          

        <form  id="form-print" enctype="text/plain" class="form-control">
            <h3 class="titleH3">CT Angiography / CT Enterography </h3>
            <h6 id="patientName">Patient Name: <input type="text"></h6>

     
        <section id="procedureInformation" class="level1" data-section-name="Procedure Information">
            <header class="level1">
                Procedure Information :-
            </header>
            <p title="">
                <label for="RADIO_1572484216316">Exam :-</label>
                <span id="RADIO_1572484216316" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1572484216316_0" type="radio" name="RADIO_1572484216316" value="CT Angiography" checked="">CT Angiography</input>
                    <br />
                    <input id="RADIO_1572484216316_1" type="radio" name="RADIO_1572484216316" value="CT Enterography">CT Enterography</input>
                </span>
            </p>
            <p title="">
                <label for="RADIO_1572484216321">Technique :-</label>
                <span id="RADIO_1572484216321" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1572484216321_0" type="radio" name="RADIO_1572484216321" value="Contrast Enhanced CT Angiography" checked="">Contrast Enhanced CT Angiography</input>
                    <br />
                    <input id="RADIO_1572484216321_1" type="radio" name="RADIO_1572484216321" value="Contrast Enhanced CT Enterography">Contrast Enhanced CT Enterography</input>
                </span>
            </p>
            <p title="">
                <label for="TEXT_1572227404909">IV contrast material (agent and volume administered)</label>
                <input type="text" id="TEXT_1572227404909" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="" />
            </p>
            <p title="">
                <label for="TEXT_1572227404910">Oral contrast material (name and amount administered)</label>
                <input type="text" id="TEXT_1572227404910" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="" />
            </p>
        </section>
        <section id="clinicalInformation" class="level1" data-section-name="Clinical Information">
            <label  class="level1">
                Clinical Information :-
            </label>
            <p title="">
                <label for="clinicalInformationText"></label>
                <textarea rows="3" cols="100" id="clinicalInformationText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE">Rule out gastrointestinal bleed</textarea>
            </p>
        </section>
        <section id="comparisons" class="level1" data-section-name="Comparison">
            <label class="level1">
                Comparison :-
            </label>
            <p title="">
                <label for="comparisonsText"></label>
                <input type="text" id="comparisonsText" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="None" />
            </p>
        </section>
        <section id="findings" class="level1" data-section-name="Findings">
            <label class="level1">
                Findings :-
            </label>
            <p title="">
                <label for="TEXT_1631631997888"></label>
                <textarea rows="3" cols="100" id="TEXT_1631631997888" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
            </p>
            <section id="SECTION_HEADER_1579014383889" class="level2" data-section-name="There is no contrast extravasation or intraluminal blood. The bowel is normal in appearance without evidence of inflammation, vascular malformation, or mass. (INSTRUCTIONS: If there is contrast extravasation or intraluminal blood, or if there are abnormal bowel segments, delete one or both of these sentences.)">
                <header class="level2">
                    There is no contrast extravasation or intraluminal blood. The bowel is normal in appearance without evidence of inflammation, vascular malformation, or mass. (INSTRUCTIONS: If there is contrast extravasation or intraluminal blood, or if there are abnormal bowel segments, delete one or both of these sentences.)
                </header>
            </section>
            <section id="SECTION_HEADER_1579111956053" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
            <section id="SECTION_HEADER_1574954488887" class="level2" data-section-name="INSTRUCTIONS FOR REPORTING THE FOLLOWING FINDINGS: If there is contrast extravasation and/or intraluminal blood with or without a sentinel clot, report the amount and location within the bowel. For contrast extravasation, describe whether this is likely an arterial or venous source of bleeding. If the associated cause of GI bleeding is identified, report the etiology and location. If a potential cause of GI bleeding is identified without associated active extravasation and/or intraluminal blood, report the lesion diagnosis and location. Consider including the series number(s) and image number(s) for important findings.">
                <header class="level2">
                    INSTRUCTIONS FOR REPORTING THE FOLLOWING FINDINGS: If there is contrast extravasation and/or intraluminal blood with or without a sentinel clot, report the amount and location within the bowel. For contrast extravasation, describe whether this is likely an arterial or venous source of bleeding. If the associated cause of GI bleeding is identified, report the etiology and location. If a potential cause of GI bleeding is identified without associated active extravasation and/or intraluminal blood, report the lesion diagnosis and location. Consider including the series number(s) and image number(s) for important findings.
                </header>
            </section>
            <p title="">
                <label for="TEXT_1626355957006">Imaging findings of active bleeding and location :-</label>
                <textarea rows="3" cols="100" id="TEXT_1626355957006" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE">Not present</textarea>
            </p>
            <p title="">
                <label for="TEXT_1626355957007">Suspected GI bleeding etiology and location</label>
                <input type="text" id="TEXT_1626355957007" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="None" />
            </p>
            <p title="">
                <label for="TEXT_1626355957008">Location of intraluminal blood, with or without a sentinel clot</label>
                <input type="text" id="TEXT_1626355957008" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="Not present" />
            </p>
            <p title="">
                <label for="TEXT_1626355957009">Other potential causes of GI bleeding</label>
                <input type="text" id="TEXT_1626355957009" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="None" />
            </p>
            <section id="SECTION_HEADER_1574954488884" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
            <section id="SECTION_HEADER_1574954488889" class="level2" data-section-name="SAMPLE FINDINGS 1:">
                <header class="level2">
                    SAMPLE FINDINGS 1:
                </header>
            </section>
            <section id="SECTION_HEADER_1574954488881" class="level2" data-section-name="There is intraluminal blood in the proximal duodenum with a sentinel clot in the duodenal bulb. There is associated contrast extravasation in the duodenal bulb on arterial phase images consistent with active bleeding (image #, series #). These findings are caused by a 10 mm duodenal bulb ulcer (image #, series #).">
                <header class="level2">
                    There is intraluminal blood in the proximal duodenum with a sentinel clot in the duodenal bulb. There is associated contrast extravasation in the duodenal bulb on arterial phase images consistent with active bleeding (image #, series #). These findings are caused by a 10 mm duodenal bulb ulcer (image #, series #).
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279101" class="level2" data-section-name="SAMPLE FINDINGS 2:">
                <header class="level2">
                    SAMPLE FINDINGS 2:
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279105" class="level2" data-section-name="There is a large amount of intraluminal blood in the ascending and transverse colon with a sentinel clot in the hepatic flexure. There is a diverticulum in the hepatic flexure which has associated contrast extravasation on arterial phase images consistent with active bleeding (image #, series #).">
                <header class="level2">
                    There is a large amount of intraluminal blood in the ascending and transverse colon with a sentinel clot in the hepatic flexure. There is a diverticulum in the hepatic flexure which has associated contrast extravasation on arterial phase images consistent with active bleeding (image #, series #).
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279100" class="level2" data-section-name="SAMPLE FINDINGS 3:">
                <header class="level2">
                    SAMPLE FINDINGS 3:
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279104" class="level2" data-section-name="There is contrast extravasation in the stomach antrum on arterial phase images consistent with active bleeding (image #, series #). However, there is no associated bowel lesion.">
                <header class="level2">
                    There is contrast extravasation in the stomach antrum on arterial phase images consistent with active bleeding (image #, series #). However, there is no associated bowel lesion.
                </header>
            </section>
            <section id="SECTION_HEADER_1626355956985" class="level2" data-section-name="SAMPLE FINDINGS 4:">
                <header class="level2">
                    SAMPLE FINDINGS 4:
                </header>
            </section>
            <section id="SECTION_HEADER_1626355956987" class="level2" data-section-name="There is intraluminal blood in the proximal jejunum (image #, series #). However, there is no associated contrast extravasation or bowel lesion.">
                <header class="level2">
                    There is intraluminal blood in the proximal jejunum (image #, series #). However, there is no associated contrast extravasation or bowel lesion.
                </header>
            </section>
            <section id="SECTION_HEADER_1626355956988" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
            <p title="">
                <label for="TEXT_1572484216324">Other findings :-</label>
                <textarea rows="3" cols="100" id="TEXT_1572484216324" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE">The lower thorax, liver, spleen, biliary system, gallbladder, pancreas, kidneys, adrenals and urinary bladder appear within normal limits. The abdominal vessels and bones appear within normal limits. There is no intra-abdominal fluid collection or lymphadenopathy.</textarea>
            </p>
            <section id="SECTION_HEADER_1626355957017" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
        </section>
        <section id="impression" class="level1" data-section-name="Impression">
            <label class="level1">
                Impression :-
            </lab>
            <p title="">
                <label for="TEXT_1631631997887"></label>
                <textarea rows="3" cols="100" id="TEXT_1631631997887" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
            </p>
            <section id="SECTION_HEADER_1626361233100" class="level2" data-section-name="No evidence of active GI bleeding or intraluminal blood. No finding to account for GI bleeding. (INSTRUCTIONS: If there is active GI bleeding or intraluminal blood, and/or if there are abnormal bowel segments, delete one or both of these sentences.)">
                <header class="level2">
                    No evidence of active GI bleeding or intraluminal blood. No finding to account for GI bleeding. (INSTRUCTIONS: If there is active GI bleeding or intraluminal blood, and/or if there are abnormal bowel segments, delete one or both of these sentences.)
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279086" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
            <section id="SECTION_HEADER_1574954488878" class="level2" data-section-name="INSTRUCTIONS FOR CREATING IMPRESSION STATEMENTS WHEN ABNORMAL FINDINGS ARE PRESENT:">
                <header class="level2">
                    INSTRUCTIONS FOR CREATING IMPRESSION STATEMENTS WHEN ABNORMAL FINDINGS ARE PRESENT:
                </header>
            </section>
            <section id="SECTION_HEADER_1626361233101" class="level2" data-section-name="For GI bleeding cases, the impression statement should indicate whether or not active bleeding is present and if there is an associated etiology that is causing the bleeding. If a bowel abnormality is present without associated active bleeding, this should be stated. The term &quot;active bleeding&quot;, which is familiar to treating physicians, should be used in the impression statement rather than &quot;active extravasation&quot;. &quot;Active extravasation&quot; or &quot;active contrast extravasation&quot; is an imaging finding, and can be used in the findings section of the report.">
                <header class="level2">
                    For GI bleeding cases, the impression statement should indicate whether or not active bleeding is present and if there is an associated etiology that is causing the bleeding. If a bowel abnormality is present without associated active bleeding, this should be stated. The term "active bleeding", which is familiar to treating physicians, should be used in the impression statement rather than "active extravasation". "Active extravasation" or "active contrast extravasation" is an imaging finding, and can be used in the findings section of the report.
                </header>
            </section>
            <section id="SECTION_HEADER_1574954488879" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
            <section id="SECTION_HEADER_1574994665853" class="level2" data-section-name="SAMPLE IMPRESSION STATEMENT 1:">
                <header class="level2">
                    SAMPLE IMPRESSION STATEMENT 1:
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279089" class="level2" data-section-name="Active bleeding in the duodenal bulb caused by a duodenal bulb ulcer. There is associated intraluminal blood.">
                <header class="level2">
                    Active bleeding in the duodenal bulb caused by a duodenal bulb ulcer. There is associated intraluminal blood.
                </header>
            </section>
            <section id="SECTION_HEADER_1575206825526" class="level2" data-section-name="">
                <header class="level2">
                </header>
            </section>
            <section id="SECTION_HEADER_1575206825522" class="level2" data-section-name="SAMPLE IMPRESSION STATEMENT 2:">
                <header class="level2">
                    SAMPLE IMPRESSION STATEMENT 2:
                </header>
            </section>
            <section id="SECTION_HEADER_1575206825523" class="level2" data-section-name="Active bleeding in the hepatic flexure of the colon caused by a colonic diverticulum. There is associated intraluminal blood.">
                <header class="level2">
                    Active bleeding in the hepatic flexure of the colon caused by a colonic diverticulum. There is associated intraluminal blood.
                </header>
            </section>
            <section id="SECTION_HEADER_1574994665859" class="level2" data-section-name="">
                <header class="level2">
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279087" class="level2" data-section-name="SAMPLE IMPRESSION STATEMENT 3:">
                <header class="level2">
                    SAMPLE IMPRESSION STATEMENT 3:
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279096" class="level2" data-section-name="Active bleeding in the stomach antrum. However, there is no associated bowel lesion.">
                <header class="level2">
                    Active bleeding in the stomach antrum. However, there is no associated bowel lesion.
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279094" class="level2" data-section-name="">
                <header class="level2">
                </header>
            </section>
            <section id="SECTION_HEADER_1575163279090" class="level2" data-section-name="SAMPLE IMPRESSION STATEMENT 4:">
                <header class="level2">
                    SAMPLE IMPRESSION STATEMENT 4:
                </header>
            </section>
            <section id="SECTION_HEADER_1574994665854" class="level2" data-section-name="Intraluminal blood in the proximal jejunum. However, there is no associated active bleeding or bowel lesion.">
                <header class="level2">
                    Intraluminal blood in the proximal jejunum. However, there is no associated active bleeding or bowel lesion.
                </header>
            </section>
            <section id="SECTION_HEADER_1626361233102" class="level2" data-section-name="_________________________________________________________________________________________________________________________________">
                <header class="level2">
                    _________________________________________________________________________________________________________________________________
                </header>
            </section>
        </section>
        <input type="button" class="btn btn-secondary" onclick="saveProgress();" value="Save Progress" id="saveProgressButton">
        <input type="button" class="btn btn-primary" onclick="GeneratePdf();" value="Submit Report" id="submitReportButton">
    </form>

    

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>


<script>
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCXxVm7oVpkuq0TPjGUs_sa4nsOTd8SmhE",
        authDomain: "dicom-admin.firebaseapp.com",
        databaseURL: "https://dicom-admin-default-rtdb.firebaseio.com",
        projectId: "dicom-admin",
        storageBucket: "dicom-admin.appspot.com",
        messagingSenderId: "43752825231",
        appId: "1:43752825231:web:6ad98d21150fd3e0f42bfa",
        measurementId: "G-EZM15EBVGQ",
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>

<script>
    var counter = 1;


    function sanitizeKey(key) {
    if (!key || key.trim() === "") {
        return '';  // Return an empty string instead of '_'
    }
    return key.replace(/[.#$/\[\]]/g, '_');
}

function saveProgress() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');
    let formData = {}; // This will directly hold key-value pairs for Firebase

    // Ensure patient name is always included
    const patientNameElement = document.querySelector('input[type="text"]');
    if (patientNameElement) {
        formData['patientName'] = patientNameElement.value;
    }

    formElements.forEach(element => {
        const sanitizedId = sanitizeKey(element.id);
        if (sanitizedId) {  // Only add if the sanitized ID is valid
            if (element.type === 'radio') {
                if (element.checked) {
                    formData[sanitizedId] = element.value;
                }
            } else {
                formData[sanitizedId] = element.value;
            }
        }
    });

    // Use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).update(formData)
        .then(() => {
            // Set the Report_Status to 'Read'
            return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Read' });
        })
        .then(() => {
            alert('Progress saved successfully.');
            window.history.back();
        })
        .catch((error) => {
            console.error('Error saving progress or updating Report_Status:', error);
            alert('Error saving progress or updating Report_Status. Please try again.');
        });
}



document.addEventListener("DOMContentLoaded", function() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');

    // Use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    // Retrieve saved data from Firebase
    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).once('value').then((snapshot) => {
        const savedData = snapshot.val();
        if (savedData) {
            formElements.forEach(element => {
                const sanitizedId = sanitizeKey(element.id);
                if (element.type === 'radio') {
                    if (savedData[sanitizedId] === element.value) {
                        element.checked = true;
                    }
                } else {
                    element.value = savedData[sanitizedId] || '';
                }
            });

            // Set the patient name if it's stored in savedData
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement && savedData['patientName']) {
                inputElement.value = savedData['patientName'];
            }

        } else {
            // If no saved data is found, set the formatted patient name
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
            }
        }
    }).catch((error) => {
        console.error('Error loading saved progress:', error);
    });
});


function GeneratePdf() {
    var element = document.getElementById("form-print");
    var submitButton = document.getElementById("submitReportButton");
    var saveButton = document.getElementById("saveProgressButton");
    var opt = {
        margin: [0.5, 0, 1, 0],
        filename: 'myfile.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    // Show the overlay with progress bar
    var overlay = document.getElementById("overlay");
    var progressBar = document.getElementById("fileUploadProgress");
    var progressText = document.getElementById("uploadPercentage");

    // Hide the submit button before generating PDF
    saveButton.style.display = "none";
    submitButton.style.display = "none";

    overlay.style.display = "flex"; // Show the overlay
    progressBar.value = 0;
    progressText.textContent = "0%";

    // Generate a PDF Blob
    html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
        var blob = pdf.output('blob');
        var randomName = "DoctorReport-" + generateUniqueId();

        // Upload blob to Firebase Storage
        var uploadTask = firebase.storage().ref(`${FirebasePath}/${randomName}.pdf`).put(blob);
        uploadTask.on('state_changed',
            (snapshot) => {
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBar.value = progress;
                progressText.textContent = Math.round(progress) + "%";
            },
            (error) => {
                console.error('Upload failed', error);
                overlay.style.display = "none"; // Hide the overlay on error
            },
            () => {
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    return firebase.database().ref(`${FirebasePath}`).update({ Dicom_ReportURL: downloadURL });
                })
                .then(() => {
                    // Set the Report_Status to 'Final'
                    return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Final' });
                })
                .then(() => {
                    addReportTimestamp(FirebasePath,doctorName);
                    alert("Report submitted successfully.");
                    overlay.style.display = "none"; // Hide the overlay on success
                    window.location.href = `https://easiofyhealth.netlify.app/DoctorPanel`;
                })
                .catch((error) => {
                    console.error('Error updating database:', error);
                    overlay.style.display = "none"; // Ensure overlay is hidden on database error
                });
            }
        );
    }).finally(function () {
        // Show the submit button after PDF generation process
        submitButton.style.display = "block";
    });
}


    function generateUniqueId() {
        return Date.now();
    }
</script>
    
    <!-- Overlay for Blur Effect -->
<div id="overlay">
    <!-- Progress Display Container -->
    <div id="uploadProgressContainer">
        <h3>Uploading Report...</h3>
        <progress id="fileUploadProgress" value="0" max="100"></progress>
        <span id="uploadPercentage">0%</span>
    </div>
  </div>
  
  <style>
#impression {
    padding: 15px; /* Provide padding within the impression section for better spacing */
    box-sizing: border-box; /* Padding included within the width */
}

#impression .level2 header {
    text-align: left; /* Align text to the left for a cleaner look */
    margin-bottom: 10px; /* Add space below the header */
    line-height: 1.6; /* Increase line height for readability */
    hyphens: auto; /* Enable automatic hyphenation */
}

#impression .level2 {
    margin-bottom: 15px; /* Add space below each level2 section */
}

#impression .level2 header,
#impression p {
    overflow-wrap: break-word; /* Break words properly to avoid overflow */
    word-wrap: break-word; /* Older property for breaking words properly */
    word-break: break-word; /* Ensure words break nicely */
    -webkit-hyphens: auto; /* Hyphenation for Safari/Chrome */
    -moz-hyphens: auto; /* Hyphenation for Firefox */
    -ms-hyphens: auto; /* Hyphenation for IE/Edge */
    hyphens: auto; /* Standard hyphenation */
}

/* Ensure that the textarea elements are also well-formatted */
#impression textarea {
    width: 100%; /* Full width to ensure it's contained within its parent */
    min-height: 50px; /* Minimum height for text area */
    padding: 10px; /* Padding inside the textarea for spacing */
    border: 1px solid #ccc; /* Border for definition */
    margin-bottom: 10px; /* Space below the textarea */
    resize: vertical; /* Allow vertical resizing only */
    font-family: Arial, sans-serif; /* Consistent font family */
    line-height: 1.6; /* Line height for readability */
}

    /* ... your other styles ... */
  
    #overlay {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
      z-index: 2; /* Sit on top */
      cursor: pointer; /* Add a pointer on hover */
    }
  
    #uploadProgressContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      text-align: center;
      z-index: 2;
    }
  
    progress {
      width: 100%; /* Full width */
      height: 20px; /* Specified height */
    }
  </style>

    </body>
</html>
