<!DOCTYPE html>
<html>
    <head>
    <title>MRI Pelvis - Cervical Cancer</title>
    <meta charset="UTF-8" />
    <meta name="dcterms.identifier" content="aeb373b4-f0e3-4d4b-8ee5-01a5e09ae42d" />
    <meta name="dcterms.title" content="MRI Pelvis - Cervical Cancer" />
    <meta name="dcterms.description" content="" />
    <meta name="dcterms.type" content="IMAGE_REPORT_TEMPLATE" />
    <meta name="dcterms.language" content="en" />
    <meta name="dcterms.publisher" content="" />
    <meta name="dcterms.rights" content="May be used freely, subject to license agreement" />
    <meta name="dcterms.license" content="http://www.radreport.org/license.pdf" />
    <meta name="dcterms.date" content="2020-06-02" />
    <meta name="dcterms.creator" content="Miriam Salib" />
    <script src="Report_Timestamp.js"></script>
    <script type="text/xml">
    <template_attributes>
        <coded_content>
            <coding_schemes>
                <coding_scheme name="RADLEX" designator="2.16.840.1.113883.6.256"></coding_scheme>
                <coding_scheme name="LOINC" designator="2.16.840.1.113883.6.1"></coding_scheme>
            </coding_schemes>
            <entry origtxt="NUMBER_1587740425486">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425487">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="findings">
                <term>
                    <code meaning="Procedure Findings" value="59776-5" scheme="LOINC"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425488">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054785_0">
                <term>
                    <code meaning="unknown" value="http://radlex.org/RID/RID5655" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054785_1">
                <term>
                    <code meaning="absent" value="http://radlex.org/RID/RID28473" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054785_2">
                <term>
                    <code meaning="present" value="http://radlex.org/RID/RID28472" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587048054839">
                <term>
                    <code meaning="endometrium" value="http://radlex.org/RID/RID30958" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587048054836">
                <term>
                    <code meaning="uterus" value="http://radlex.org/RID/RID302" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054799_0">
                <term>
                    <code meaning="unknown" value="http://radlex.org/RID/RID5655" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054799_1">
                <term>
                    <code meaning="absent" value="http://radlex.org/RID/RID28473" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054799_2">
                <term>
                    <code meaning="present" value="http://radlex.org/RID/RID28472" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="clinicalInformationText">
                <term>
                    <code meaning="indication" value="http://radlex.org/RID/RID49442" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054794">
                <term>
                    <code meaning="vaginal" value="http://radlex.org/RID/RID11200" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054794_0">
                <term>
                    <code meaning="unknown" value="http://radlex.org/RID/RID5655" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054794_1">
                <term>
                    <code meaning="none" value="http://radlex.org/RID/RID28454" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054794_2">
                <term>
                    <code meaning="vagina" value="http://radlex.org/RID/RID325" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054794_3">
                <term>
                    <code meaning="vagina" value="http://radlex.org/RID/RID325" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425495_0">
                <term>
                    <code meaning="present" value="http://radlex.org/RID/RID28472" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425495_1">
                <term>
                    <code meaning="absent" value="http://radlex.org/RID/RID28473" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054828">
                <term>
                    <code meaning="lymph node of pelvis" value="http://radlex.org/RID/RID32116" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587048054829">
                <term>
                    <code meaning="lymph node of pelvis" value="http://radlex.org/RID/RID32116" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="procedureInformation">
                <term>
                    <code meaning="Current Imaging Procedure Description" value="55111-9" scheme="LOINC"></code>
                </term>
            </entry>
            <entry origtxt="comparisons">
                <term>
                    <code meaning="Radiology Comparison Study" value="18834-2" scheme="LOINC"></code>
                </term>
            </entry>
            <entry origtxt="impression">
                <term>
                    <code meaning="Impressions" value="19005-8" scheme="LOINC"></code>
                </term>
            </entry>
            <entry origtxt="procedureInformationText">
                <term>
                    <code meaning="imaging procedure" value="http://radlex.org/RID/RID13060" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054809">
                <term>
                    <code meaning="lymph node of pelvis" value="http://radlex.org/RID/RID32116" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054809_0">
                <term>
                    <code meaning="none" value="http://radlex.org/RID/RID28454" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054809_1">
                <term>
                    <code meaning="few" value="http://radlex.org/RID/RID5763" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054846">
                <term>
                    <code meaning="cervical cancer" value="http://radlex.org/RID/RID45683" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054846_0">
                <term>
                    <code meaning="unknown" value="http://radlex.org/RID/RID5655" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054846_1">
                <term>
                    <code meaning="absent" value="http://radlex.org/RID/RID28473" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054846_2">
                <term>
                    <code meaning="present" value="http://radlex.org/RID/RID28472" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_0">
                <term>
                    <code meaning="none" value="http://radlex.org/RID/RID28454" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_1">
                <term>
                    <code meaning="pelvic wall" value="http://radlex.org/RID/RID30760" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_2">
                <term>
                    <code meaning="pelvic wall" value="http://radlex.org/RID/RID30760" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_3">
                <term>
                    <code meaning="right ureter" value="http://radlex.org/RID/RID30844" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_4">
                <term>
                    <code meaning="left ureter" value="http://radlex.org/RID/RID30845" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_5">
                <term>
                    <code meaning="urinary bladder" value="http://radlex.org/RID/RID237" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587048054805_6">
                <term>
                    <code meaning="rectum" value="http://radlex.org/RID/RID163" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425468">
                <term>
                    <code meaning="uterus" value="http://radlex.org/RID/RID302" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425469">
                <term>
                    <code meaning="uterus" value="http://radlex.org/RID/RID302" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587740425485">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054837">
                <term>
                    <code meaning="uterus" value="http://radlex.org/RID/RID302" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425482">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425482_0">
                <term>
                    <code meaning="normal" value="http://radlex.org/RID/RID13173" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425482_1">
                <term>
                    <code meaning="abnormal" value="http://radlex.org/RID/RID28453" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425489_0">
                <term>
                    <code meaning="present" value="http://radlex.org/RID/RID28472" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425489_1">
                <term>
                    <code meaning="absent" value="http://radlex.org/RID/RID28473" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425477">
                <term>
                    <code meaning="left ovary" value="http://radlex.org/RID/RID32830" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="NUMBER_1587740425478">
                <term>
                    <code meaning="left ovary" value="http://radlex.org/RID/RID32830" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425473_0">
                <term>
                    <code meaning="normal" value="http://radlex.org/RID/RID13173" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425473_1">
                <term>
                    <code meaning="abnormal" value="http://radlex.org/RID/RID28453" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054844">
                <term>
                    <code meaning="bone of pelvis" value="http://radlex.org/RID/RID2508" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425470">
                <term>
                    <code meaning="left ovary" value="http://radlex.org/RID/RID32830" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425470_1">
                <term>
                    <code meaning="not seen" value="http://radlex.org/RID/RID38584" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054840">
                <term>
                    <code meaning="endometrium" value="http://radlex.org/RID/RID30958" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054841">
                <term>
                    <code meaning="ovary" value="http://radlex.org/RID/RID290" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="clinicalInformation">
                <term>
                    <code meaning="Clinical Information" value="55752-0" scheme="LOINC"></code>
                </term>
            </entry>
            <entry origtxt="TEXT_1587048054842">
                <term>
                    <code meaning="fluid" value="http://radlex.org/RID/RID1547" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425479">
                <term>
                    <code meaning="right ovary" value="http://radlex.org/RID/RID32829" scheme="RADLEX"></code>
                </term>
            </entry>
            <entry origtxt="RADIO_1587740425479_1">
                <term>
                    <code meaning="not seen" value="http://radlex.org/RID/RID38584" scheme="RADLEX"></code>
                </term>
            </entry>
        </coded_content>
    </template_attributes>
    </script>
    <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" rel="stylesheet">
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous"></script> -->
   
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>

	
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous">
</script>

<style>
    textarea {
        width: -webkit-fill-available;
    }
    #form-print{
    width: 80%;
    padding: 11px;
    background-color: #7e7e7e59;
    border: 2px solid darkgray;
    margin-right: auto;
    margin: auto;
    }
    .titleH3{
        padding: 10px;
        text-align: center;
        text-decoration-line: underline;
    }

    label {
        font-weight: 600;
    }
</style>

</head>
    <body>

        <script>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            let FirebasePath = urlParams.get('path');
            const doctorName = urlParams.get("DoctorName");
         
            const pathArray = FirebasePath.split('/');
            const patient = pathArray[pathArray.length - 2];   
            const patientParts = patient.split('-').map(part => part.trim());
            let formattedPatientName;
          
            // More robust check for repeated "Patient" parts
            if (patientParts.length > 2 && patientParts[0].toLowerCase() === "patient" && patientParts[1].toLowerCase() === "patient") {
              // If 'Patient' is repeated, format as "Patient - [Last Part]"
              formattedPatientName = patientParts.slice(2).join(' - ');
            } else {
              // Use the name after "Patient -", or the full name if the condition doesn't match
              formattedPatientName = patientParts.slice(1).join(' - ');
            }
          
            console.log("Formatted patient name ---", formattedPatientName); 
          
            // Set the formatted name to the input element once the DOM is fully loaded
            document.addEventListener("DOMContentLoaded", function() {
              const inputElement = document.querySelector('input[type="text"]');
              if(inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
              }
            });
          </script>
          

        <form  id="form-print" enctype="text/plain" class="form-control">
            <h3 class="titleH3">MRI Pelvis Cervical Cancer</h3>
            <h6 id="patientName">Patient Name: <input type="text"></h6>

      
      
    <section id="procedureInformation" class="level1" data-section-name="Procedure Information">
        <header class="level1">
            Procedure Information
        </header>
        <p title="">
            <label for="procedureInformationText">History :-</label>
            <textarea rows="3" cols="100" id="procedureInformationText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="TEXT_1587048054784">Technique :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054784" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
    </section>
    <section id="clinicalInformation" class="level1" data-section-name="Clinical Information">
        <header class="level1">
            Clinical Information
        </header>
        <p title="">
            <label for="clinicalInformationText">Indication :-</label>
            <textarea rows="3" cols="100" id="clinicalInformationText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
    </section>
    <section id="comparisons" class="level1" data-section-name="Comparison">
        <label class="level1">
            Comparison :-
        </label>
        <p title="">
            <label for="comparisonsText"></label>
            <textarea rows="3" cols="100" id="comparisonsText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
    </section>
    <section id="findings" class="level1" data-section-name="Findings">
        <header class="level1">
            Findings
        </header>
        <p title="">
            <label for="RADIO_1587048054785">Presence of tumor</label>
            <span id="RADIO_1587048054785" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054785_0" type="radio" name="RADIO_1587048054785" value="Unknown" checked="">Unknown</input>
                <br />
                <input id="RADIO_1587048054785_1" type="radio" name="RADIO_1587048054785" value="Absent">Absent</input>
                <br />
                <input id="RADIO_1587048054785_2" type="radio" name="RADIO_1587048054785" value="Present">Present</input>
            </span>
        </p>
        <p title="">
            <label for="findingsText">Tumor site :-</label>
            <textarea rows="3" cols="100" id="findingsText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="NUMBER_1587740425442">Tumor height</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425442" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425443">Tumor length</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425443" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587048054789">Tumor width</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587048054789" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054790">Tumor size classification</label>
            <span id="RADIO_1587048054790" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054790_0" type="radio" name="RADIO_1587048054790" value="Less than 2 cm maximum diameter" checked="">Less than 2 cm maximum diameter</input>
                <br />
                <input id="RADIO_1587048054790_1" type="radio" name="RADIO_1587048054790" value="Greater than or equal to 2 cm and less than 4 cm maximum diameter">Greater than or equal to 2 cm and less than 4 cm maximum diameter</input>
                <br />
                <input id="RADIO_1587048054790_2" type="radio" name="RADIO_1587048054790" value="Greater than or equal to 4 cm maximum diameter">Greater than or equal to 4 cm maximum diameter</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054799">Uterine invasion</label>
            <span id="RADIO_1587048054799" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054799_0" type="radio" name="RADIO_1587048054799" value="Unknown" checked="">Unknown</input>
                <br />
                <input id="RADIO_1587048054799_1" type="radio" name="RADIO_1587048054799" value="Absent">Absent</input>
                <br />
                <input id="RADIO_1587048054799_2" type="radio" name="RADIO_1587048054799" value="Present">Present</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054794">Vaginal invasion</label>
            <span id="RADIO_1587048054794" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054794_0" type="radio" name="RADIO_1587048054794" value="Unknown" checked="">Unknown</input>
                <br />
                <input id="RADIO_1587048054794_1" type="radio" name="RADIO_1587048054794" value="None">None</input>
                <br />
                <input id="RADIO_1587048054794_2" type="radio" name="RADIO_1587048054794" value="Upper two thirds of vagina">Upper two thirds of vagina</input>
                <br />
                <input id="RADIO_1587048054794_3" type="radio" name="RADIO_1587048054794" value="Lower one third of vagina">Lower one third of vagina</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054802">Parametrial invasion</label>
            <span id="RADIO_1587048054802" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054802_0" type="radio" name="RADIO_1587048054802" value="Unknown" checked="">Unknown</input>
                <br />
                <input id="RADIO_1587048054802_1" type="radio" name="RADIO_1587048054802" value="Present">Present</input>
                <br />
                <input id="RADIO_1587048054802_2" type="radio" name="RADIO_1587048054802" value="Absent">Absent</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054805">Tumor extension</label>
            <span id="RADIO_1587048054805" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054805_0" type="radio" name="RADIO_1587048054805" value="None" checked="">None</input>
                <br />
                <input id="RADIO_1587048054805_1" type="radio" name="RADIO_1587048054805" value="Right pelvic sidewall">Right pelvic sidewall</input>
                <br />
                <input id="RADIO_1587048054805_2" type="radio" name="RADIO_1587048054805" value="Left pelvic sidewall">Left pelvic sidewall</input>
                <br />
                <input id="RADIO_1587048054805_3" type="radio" name="RADIO_1587048054805" value="Right ureter">Right ureter</input>
                <br />
                <input id="RADIO_1587048054805_4" type="radio" name="RADIO_1587048054805" value="Left ureter">Left ureter</input>
                <br />
                <input id="RADIO_1587048054805_5" type="radio" name="RADIO_1587048054805" value="Bladder">Bladder</input>
                <br />
                <input id="RADIO_1587048054805_6" type="radio" name="RADIO_1587048054805" value="Rectum">Rectum</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054808">Additional tumor comment :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054808" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="RADIO_1587048054809">Pelvic lymph node</label>
            <span id="RADIO_1587048054809" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054809_0" type="radio" name="RADIO_1587048054809" value="None" checked="">None</input>
                <br />
                <input id="RADIO_1587048054809_1" type="radio" name="RADIO_1587048054809" value="Few">Few</input>
                <br />
                <input id="RADIO_1587048054809_2" type="radio" name="RADIO_1587048054809" value="Many">Many</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054828">Pelvic lymph node location :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054828" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="NUMBER_1587048054829">Largest pelvic lymph node size</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587048054829" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587048054830">Para-aortic lymph node </label>
            <span id="RADIO_1587048054830" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054830_0" type="radio" name="RADIO_1587048054830" value="None" checked="">None</input>
                <br />
                <input id="RADIO_1587048054830_1" type="radio" name="RADIO_1587048054830" value="Few">Few</input>
                <br />
                <input id="RADIO_1587048054830_2" type="radio" name="RADIO_1587048054830" value="Many">Many</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054834">Para-aortic lymph node location :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054834" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="NUMBER_1587048054835">Largest para-aortic lymph node size</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587048054835" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425468">Uterus height</label>
            <span>
                <input type="number" step="1.0" data-field-units="cm" id="NUMBER_1587740425468" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                cm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587048054836">Uterus length</label>
            <span>
                <input type="number" step="1.0" data-field-units="cm" id="NUMBER_1587048054836" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                cm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425469">Uterus width</label>
            <span>
                <input type="number" step="1.0" data-field-units="cm" id="NUMBER_1587740425469" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                cm
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054837">Uterus position :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054837" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        
        <p title="">
            <label for="NUMBER_1587048054839">Endometrium maximum thickness</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587048054839" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054840">Other endometrial finding :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054840" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="RADIO_1587740425470">Left ovary visible</label>
            <span id="RADIO_1587740425470" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425470_0" type="radio" name="RADIO_1587740425470" value="Seen" checked="">Seen</input>
                <br />
                <input id="RADIO_1587740425470_1" type="radio" name="RADIO_1587740425470" value="Not seen">Not seen</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587740425473">Left ovary appearance</label>
            <span id="RADIO_1587740425473" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425473_0" type="radio" name="RADIO_1587740425473" value="Normal in appearance" checked="">Normal in appearance</input>
                <br />
                <input id="RADIO_1587740425473_1" type="radio" name="RADIO_1587740425473" value="Abnormal">Abnormal</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054841">Left ovary abnormalty description :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054841" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="NUMBER_1587740425476">Left ovary height</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425476" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425477">Left ovary length</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425477" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425478">Left ovary width</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425478" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587740425479">Right ovary visible</label>
            <span id="RADIO_1587740425479" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425479_0" type="radio" name="RADIO_1587740425479" value="Seen" checked="">Seen</input>
                <br />
                <input id="RADIO_1587740425479_1" type="radio" name="RADIO_1587740425479" value="Not seen">Not seen</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587740425482">Right ovary appearance</label>
            <span id="RADIO_1587740425482" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425482_0" type="radio" name="RADIO_1587740425482" value="Normal in appearance" checked="">Normal in appearance</input>
                <br />
                <input id="RADIO_1587740425482_1" type="radio" name="RADIO_1587740425482" value="Abnormal">Abnormal</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587740425485">Right ovary abnormalty description</label>
            <input type="text" id="TEXT_1587740425485" name="" data-field-type="TEXT" data-field-completion-action="NONE" value="" />
        </p>
        <p title="">
            <label for="NUMBER_1587740425486">Right ovary height</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425486" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425487">Right ovary length</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425487" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425488">Right ovary width</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425488" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054842">Free fluid :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054842" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="RADIO_1587740425495">Pelvic peritoneal disease</label>
            <span id="RADIO_1587740425495" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425495_0" type="radio" name="RADIO_1587740425495" value="present" checked="">present</input>
                <br />
                <input id="RADIO_1587740425495_1" type="radio" name="RADIO_1587740425495" value="absent">absent</input>
            </span>
        </p>
        <p title="">
            <label for="RADIO_1587740425489">Suspicious bone lesion </label>
            <span id="RADIO_1587740425489" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587740425489_0" type="radio" name="RADIO_1587740425489" value="present" checked="">present</input>
                <br />
                <input id="RADIO_1587740425489_1" type="radio" name="RADIO_1587740425489" value="absent">absent</input>
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054844">Suspicious bone lesion location :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054844" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        <p title="">
            <label for="NUMBER_1587740425492">Suspicious bone lesion height</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425492" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425493">Suspicious bone lesion length</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425493" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="NUMBER_1587740425494">Suspicious bone lesion width</label>
            <span>
                <input type="number" step="1.0" data-field-units="mm" id="NUMBER_1587740425494" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                mm
            </span>
        </p>
        <p title="">
            <label for="TEXT_1587048054845">Additional comment :-</label>
            <textarea rows="3" cols="100" id="TEXT_1587048054845" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
    </section>
    <section id="impression" class="level1" data-section-name="Impression">
        <header class="level1">
            Impression
        </header>
        <p title="">
            <label for="RADIO_1587048054846">Cervical cancer detection</label>
            <span id="RADIO_1587048054846" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                <br />
                <input id="RADIO_1587048054846_0" type="radio" name="RADIO_1587048054846" value="Unknown" checked="">Unknown</input>
                <br />
                <input id="RADIO_1587048054846_1" type="radio" name="RADIO_1587048054846" value="Absent">Absent</input>
                <br />
                <input id="RADIO_1587048054846_2" type="radio" name="RADIO_1587048054846" value="Present">Present</input>
            </span>
        </p>
        <p title="">
            <label for="impressionText">Additional information :-</label>
            <textarea rows="3" cols="100" id="impressionText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
        </p>
        
    </section>
    <input type="button" class="btn btn-secondary" onclick="saveProgress();" value="Save Progress" id="saveProgressButton">
    <input type="button" class="btn btn-primary" onclick="GeneratePdf();" value="Submit Report" id="submitReportButton">
</form>
    

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>


<script>
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCXxVm7oVpkuq0TPjGUs_sa4nsOTd8SmhE",
        authDomain: "dicom-admin.firebaseapp.com",
        databaseURL: "https://dicom-admin-default-rtdb.firebaseio.com",
        projectId: "dicom-admin",
        storageBucket: "dicom-admin.appspot.com",
        messagingSenderId: "43752825231",
        appId: "1:43752825231:web:6ad98d21150fd3e0f42bfa",
        measurementId: "G-EZM15EBVGQ",
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous">
</script> 

<script>
    var counter = 1;


    function sanitizeKey(key) {
    if (!key || key.trim() === "") {
        return '';  // Return an empty string instead of '_'
    }
    return key.replace(/[.#$/\[\]]/g, '_');
}

function saveProgress() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');
    let formData = {}; // This will directly hold key-value pairs for Firebase

    // Ensure patient name is always included
    const patientNameElement = document.querySelector('input[type="text"]');
    if (patientNameElement) {
        formData['patientName'] = patientNameElement.value;
    }

    formElements.forEach(element => {
        const sanitizedId = sanitizeKey(element.id);
        if (sanitizedId) {  // Only add if the sanitized ID is valid
            if (element.type === 'radio') {
                if (element.checked) {
                    formData[sanitizedId] = element.value;
                }
            } else {
                formData[sanitizedId] = element.value;
            }
        }
    });

    // Use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).update(formData)
        .then(() => {
            // Set the Report_Status to 'Read'
            return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Read' });
        })
        .then(() => {
            alert('Progress saved successfully.');
            window.history.back();
        })
        .catch((error) => {
            console.error('Error saving progress or updating Report_Status:', error);
            alert('Error saving progress or updating Report_Status. Please try again.');
        });
}


document.addEventListener("DOMContentLoaded", function() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');

    // Use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    // Retrieve saved data from Firebase
    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).once('value').then((snapshot) => {
        const savedData = snapshot.val();
        if (savedData) {
            formElements.forEach(element => {
                const sanitizedId = sanitizeKey(element.id);
                if (element.type === 'radio') {
                    if (savedData[sanitizedId] === element.value) {
                        element.checked = true;
                    }
                } else {
                    element.value = savedData[sanitizedId] || '';
                }
            });

            // Set the patient name if it's stored in savedData
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement && savedData['patientName']) {
                inputElement.value = savedData['patientName'];
            }

        } else {
            // If no saved data is found, set the formatted patient name
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
            }
        }
    }).catch((error) => {
        console.error('Error loading saved progress:', error);
    });
})

function GeneratePdf() {
    var element = document.getElementById("form-print");
    var submitButton = document.getElementById("submitReportButton");
    var saveButton = document.getElementById("saveProgressButton");
    var opt = {
        margin: [0.5, 0, 1, 0],
        filename: 'myfile.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    // Show the overlay with progress bar
    var overlay = document.getElementById("overlay");
    var progressBar = document.getElementById("fileUploadProgress");
    var progressText = document.getElementById("uploadPercentage");

    // Hide the submit button before generating PDF
    saveButton.style.display = "none";
    submitButton.style.display = "none";

    overlay.style.display = "flex"; // Show the overlay
    progressBar.value = 0;
    progressText.textContent = "0%";

    // Generate a PDF Blob
    html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
        var blob = pdf.output('blob');
        var randomName = "DoctorReport-" + generateUniqueId();

        // Upload blob to Firebase Storage
        var uploadTask = firebase.storage().ref(`${FirebasePath}/${randomName}.pdf`).put(blob);
        uploadTask.on('state_changed',
            (snapshot) => {
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBar.value = progress;
                progressText.textContent = Math.round(progress) + "%";
            },
            (error) => {
                console.error('Upload failed', error);
                overlay.style.display = "none"; // Hide the overlay on error
            },
            () => {
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    return firebase.database().ref(`${FirebasePath}`).update({ Dicom_ReportURL: downloadURL });
                })
                .then(() => {
                    // Set the Report_Status to 'Final'
                    return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Final' });
                })
                .then(() => {
                    addReportTimestamp(FirebasePath,doctorName);
                    alert("Report submitted successfully.");
                    overlay.style.display = "none"; // Hide the overlay on success
                    window.location.href = `https://easiofyhealth.netlify.app/DoctorPanel`;
                })
                .catch((error) => {
                    console.error('Error updating database:', error);
                    overlay.style.display = "none"; // Ensure overlay is hidden on database error
                });
            }
        );
    }).finally(function () {
        // Show the submit button after PDF generation process
        submitButton.style.display = "block";
    });
}


    function generateUniqueId() {
        return Date.now();
    }
</script>
    
    <!-- Overlay for Blur Effect -->
<div id="overlay">
    <!-- Progress Display Container -->
    <div id="uploadProgressContainer">
        <h3>Uploading Report...</h3>
        <progress id="fileUploadProgress" value="0" max="100"></progress>
        <span id="uploadPercentage">0%</span>
    </div>
  </div>
  
  <style>
    /* ... your other styles ... */
  
    #overlay {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
      z-index: 2; /* Sit on top */
      cursor: pointer; /* Add a pointer on hover */
    }
  
    #uploadProgressContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      text-align: center;
      z-index: 2;
    }
  
    progress {
      width: 100%; /* Full width */
      height: 20px; /* Specified height */
    }
  </style>

</body>
</html>
