<!DOCTYPE html>
<html>
    <head>
        <title>CTA Heart Fractional Flow Reserve</title>
        <meta charset="UTF-8" />
        <meta name="dcterms.identifier" content="0f7f1a76-fc75-4afe-92ea-db9e8dab9ea2" />
        <meta name="dcterms.title" content="CTA Heart Fractional Flow Reserve" />
        <meta name="dcterms.description" content="" />
        <meta name="dcterms.type" content="IMAGE_REPORT_TEMPLATE" />
        <meta name="dcterms.language" content="en" />
        <meta name="dcterms.publisher" content="" />
        <meta name="dcterms.rights" content="May be used freely, subject to license agreement" />
        <meta name="dcterms.license" content="http://www.radreport.org/license.pdf" />
        <meta name="dcterms.date" content="2022-01-11" />
        <meta name="dcterms.creator" content="Rajiah" />
        <script src="Report_Timestamp.js"></script>
        <script type="text/xml">
            <template_attributes>
                <coded_content>
                    <coding_schemes>
                        <coding_scheme name="RADLEX" designator="2.16.840.1.113883.6.256"></coding_scheme>
                        <coding_scheme name="LOINC" designator="2.16.840.1.113883.6.1"></coding_scheme>
                    </coding_schemes>
                    <entry origtxt="procedureInformationText">
                        <term>
                            <code meaning="imaging procedure" value="http://radlex.org/RID/RID13060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="findings">
                        <term>
                            <code meaning="Procedure Findings" value="59776-5" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1639150690193_0">
                        <term>
                            <code meaning="low" value="http://radlex.org/RID/RID46059" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1639150690193_2">
                        <term>
                            <code meaning="high" value="http://radlex.org/RID/RID46060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064343_0">
                        <term>
                            <code meaning="low" value="http://radlex.org/RID/RID46059" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064343_2">
                        <term>
                            <code meaning="high" value="http://radlex.org/RID/RID46060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="SECTION_HEADER_1639150690192">
                        <term>
                            <code meaning="left coronary artery" value="http://radlex.org/RID/RID486" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1639150690189">
                        <term>
                            <code meaning="chest pain" value="http://radlex.org/RID/RID45774" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1639150690189_0">
                        <term>
                            <code meaning="stable" value="http://radlex.org/RID/RID5734" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1639150690189_1">
                        <term>
                            <code meaning="acute" value="http://radlex.org/RID/RID5718" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="SECTION_HEADER_1641926064355">
                        <term>
                            <code meaning="right coronary artery" value="http://radlex.org/RID/RID544" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="impressionText">
                        <term>
                            <code meaning="impression" value="http://radlex.org/RID/RID49895" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="procedureInformation">
                        <term>
                            <code meaning="Current Imaging Procedure Description" value="55111-9" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="comparisonsText">
                        <term>
                            <code meaning="computed tomography" value="http://radlex.org/RID/RID10321" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064334_0">
                        <term>
                            <code meaning="low" value="http://radlex.org/RID/RID46059" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064334_2">
                        <term>
                            <code meaning="high" value="http://radlex.org/RID/RID46060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064356_0">
                        <term>
                            <code meaning="low" value="http://radlex.org/RID/RID46059" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="RADIO_1641926064356_2">
                        <term>
                            <code meaning="high" value="http://radlex.org/RID/RID46060" scheme="RADLEX"></code>
                        </term>
                    </entry>
                    <entry origtxt="comparisons">
                        <term>
                            <code meaning="Radiology Comparison Study" value="18834-2" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="impression">
                        <term>
                            <code meaning="Impressions" value="19005-8" scheme="LOINC"></code>
                        </term>
                    </entry>
                    <entry origtxt="clinicalInformation">
                        <term>
                            <code meaning="Clinical Information" value="55752-0" scheme="LOINC"></code>
                        </term>
                    </entry>
                </coded_content>
            </template_attributes>
        </script>

<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" rel="stylesheet">
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous"></script> -->
   
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>

<style>
    textarea {
        width: -webkit-fill-available;
    }
    #form-print{
    width: 80%;
    padding: 11px;
    background-color: #7e7e7e59;
    border: 2px solid darkgray;
    margin-right: auto;
    margin: auto;
    }
    .titleH3{
        padding: 10px;
        text-align: center;
        text-decoration-line: underline;
    }

    label {
        font-weight: 600;
    }
</style>

    </head>
    <body>

        <script>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            let FirebasePath = urlParams.get('path');
            const doctorName = urlParams.get("DoctorName");
       
            const pathArray = FirebasePath.split('/');
            const patient = pathArray[pathArray.length - 2];   
            const patientParts = patient.split('-').map(part => part.trim());
            let formattedPatientName;
          
            // More robust check for repeated "Patient" parts
            if (patientParts.length > 2 && patientParts[0].toLowerCase() === "patient" && patientParts[1].toLowerCase() === "patient") {
              // If 'Patient' is repeated, format as "Patient - [Last Part]"
              formattedPatientName = patientParts.slice(2).join(' - ');
            } else {
              // Use the name after "Patient -", or the full name if the condition doesn't match
              formattedPatientName = patientParts.slice(1).join(' - ');
            }
          
            console.log("Formatted patient name ---", formattedPatientName); 
          
            // Set the formatted name to the input element once the DOM is fully loaded
            document.addEventListener("DOMContentLoaded", function() {
              const inputElement = document.querySelector('input[type="text"]');
              if(inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
              }
            });
          </script>

        <form  id="form-print" enctype="text/plain" class="form-control">
            <h3 class="titleH3">CTA Heart Fractional Flow Reserve</h3>
            <h6 id="patientName">Patient Name: <input type="text"></h6>

     
      
        <section id="procedureInformation" class="level1" data-section-name="Procedure Information">
            <label class="level1">
                Procedure Information :-
            </label>
            <p title="">
                <label for="procedureInformationText"></label>
                <textarea rows="3" cols="100" id="procedureInformationText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
            </p>
        </section>
        <section id="clinicalInformation" class="level1" data-section-name="Clinical Information">
            <label class="level1">
                Clinical Information :-
            </label>
            <p title="">
                <label for="RADIO_1639150690189">Chest pain</label>
                <span id="RADIO_1639150690189" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1639150690189_0" type="radio" name="RADIO_1639150690189" value="stable" checked="">stable</input>
                    <br />
                    <input id="RADIO_1639150690189_1" type="radio" name="RADIO_1639150690189" value="acute">acute</input>
                </span>
            </p>
        </section>
        <section id="comparisons" class="level1" data-section-name="Comparison">
            <label class="level1">
                Comparison 
            </label>
            <p title="">
                <label for="comparisonsText">Coronary CTA :-</label>
                <textarea rows="3" cols="100" id="comparisonsText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
            </p>
        </section>
        <section id="findings" class="level1" data-section-name="Findings">
            <label class="level1">
                Findings :-
            </label>
            <section id="SECTION_HEADER_1639150690192" class="level2" data-section-name="&nbsp;Left main coronary artery">
                <header class="level2">
                    Left main coronary artery
                </header>
            </section>
            <p title="">
                <label for="RADIO_1639150690193">Likelihood of flow-limiting lesion</label>
                <span id="RADIO_1639150690193" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1639150690193_0" type="radio" name="RADIO_1639150690193" value="low" checked="">low</input>
                    <br />
                    <input id="RADIO_1639150690193_1" type="radio" name="RADIO_1639150690193" value="borderline">borderline</input>
                    <br />
                    <input id="RADIO_1639150690193_2" type="radio" name="RADIO_1639150690193" value="high">high</input>
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064328" class="level2" data-section-name="Fractional flow reserve CT (FFRCT)">
                <label class="level2">
                    Fractional flow reserve CT (FFRCT) :-
                </label>
            </section>
            <p title="">
                <label for="NUMBER_1641926064329">2 cm distal to stenosis</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064329" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064330">Proximal vessel in abnormal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064330" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064331">Distal most vessel in normal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064331" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064333" class="level2" data-section-name="Left anterior descending artery">
                <header class="level2">
                    Left anterior descending artery
                </header>
            </section>
            <p title="">
                <label for="RADIO_1641926064334">Likelihood of flow-limiting lesion :-</label>
                <span id="RADIO_1641926064334" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1641926064334_0" type="radio" name="RADIO_1641926064334" value="low" checked="">low</input>
                    <br />
                    <input id="RADIO_1641926064334_1" type="radio" name="RADIO_1641926064334" value="borderline">borderline</input>
                    <br />
                    <input id="RADIO_1641926064334_2" type="radio" name="RADIO_1641926064334" value="high">high</input>
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064338" class="level2" data-section-name="Fractional flow reserve CT (FFRCT)">
                <header class="level2">
                    Fractional flow reserve CT (FFRCT)
                </header>
            </section>
            <p title="">
                <label for="NUMBER_1641926064339">2 cm distal to stenosis</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064339" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064340">Proximal vessel in abnormal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064340" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064341">Distal most vessel in normal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064341" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064342" class="level2" data-section-name="Left circumflex artery">
                <header class="level2">
                    Left circumflex artery
                </header>
            </section>
            <p title="">
                <label for="RADIO_1641926064343">Likelihood of flow-limiting lesion :-</label>
                <span id="RADIO_1641926064343" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1641926064343_0" type="radio" name="RADIO_1641926064343" value="low" checked="">low</input>
                    <br />
                    <input id="RADIO_1641926064343_1" type="radio" name="RADIO_1641926064343" value="borderline">borderline</input>
                    <br />
                    <input id="RADIO_1641926064343_2" type="radio" name="RADIO_1641926064343" value="high">high</input>
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064350" class="level2" data-section-name="Fractional flow reserve CT (FFRCT)">
                <header class="level2">
                    Fractional flow reserve CT (FFRCT)
                </header>
            </section>
            <p title="">
                <label for="NUMBER_1641926064351">2 cm distal to stenosis</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064351" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064352">Proximal vessel in abnormal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064352" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064353">Distal most vessel in normal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064353" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064355" class="level2" data-section-name="Right coronary artery">
                <header class="level2">
                    Right coronary artery
                </header>
            </section>
            <p title="">
                <label for="RADIO_1641926064356">Likelihood of flow-limiting lesion</label>
                <span id="RADIO_1641926064356" name="" data-field-type="RADIO" data-field-completion-action="NONE" value="">
                    <br />
                    <input id="RADIO_1641926064356_0" type="radio" name="RADIO_1641926064356" value="low" checked="">low</input>
                    <br />
                    <input id="RADIO_1641926064356_1" type="radio" name="RADIO_1641926064356" value="borderline">borderline</input>
                    <br />
                    <input id="RADIO_1641926064356_2" type="radio" name="RADIO_1641926064356" value="high">high</input>
                </span>
            </p>
            <section id="SECTION_HEADER_1641926064360" class="level2" data-section-name="Fractional flow reserve CT (FFRCT)">
                <header class="level2">
                    Fractional flow reserve CT (FFRCT)
                </header>
            </section>
            <p title="">
                <label for="NUMBER_1641926064361">2 cm distal to stenosis</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064361" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064362">Proximal vessel in abnormal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064362" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
            <p title="">
                <label for="NUMBER_1641926064363">Distal most vessel in normal vessel</label>
                <span>
                    <input type="number" step="2.0" data-field-units="" id="NUMBER_1641926064363" name="" data-field-type="NUMBER" data-field-completion-action="NONE" value="" />
                </span>
            </p>
        </section>
        <section id="impression" class="level1" data-section-name="Impression">
            <label class="level1">
                Impression :-
            </label>
            <p title="">
                <label for="impressionText"></label>
                <textarea rows="3" cols="100" id="impressionText" name="" data-field-type="TEXTAREA" data-field-completion-action="NONE"></textarea>
            </p>
        </section>
        <input type="button" class="btn btn-secondary" onclick="saveProgress();" value="Save Progress" id="saveProgressButton">

        <input type="button" class="btn btn-primary" onclick="GeneratePdf();" value="Submit Report" id="submitReportButton">
    </form>



<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>


<script>
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCXxVm7oVpkuq0TPjGUs_sa4nsOTd8SmhE",
        authDomain: "dicom-admin.firebaseapp.com",
        databaseURL: "https://dicom-admin-default-rtdb.firebaseio.com",
        projectId: "dicom-admin",
        storageBucket: "dicom-admin.appspot.com",
        messagingSenderId: "43752825231",
        appId: "1:43752825231:web:6ad98d21150fd3e0f42bfa",
        measurementId: "G-EZM15EBVGQ",
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.1/html2pdf.bundle.min.js" integrity="sha512vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous">
</script> 


<script>

function sanitizeKey(key) {
    if (!key || key.trim() === "") {
        return '';  // Return an empty string instead of '_'
    }
    return key.replace(/[.#$/\[\]]/g, '_');
}
function saveProgress() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');
    let formData = {}; // This will directly hold key-value pairs for Firebase

    // Ensure patient name is always included
    const patientNameElement = document.querySelector('input[type="text"]');
    if (patientNameElement) {
        formData['patientName'] = patientNameElement.value;
    }

    formElements.forEach(element => {
        const sanitizedId = sanitizeKey(element.id);
        if (sanitizedId) {  // Only add if the sanitized ID is valid
            if (element.type === 'radio') {
                if (element.checked) {
                    formData[sanitizedId] = element.value;
                }
            } else {
                formData[sanitizedId] = element.value;
            }
        }
    });

    // Assume you want to use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).update(formData)
        .then(() => {
            // Set the Report_Status to 'Read'
            return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Read' });
        })
        .then(() => {
            alert('Progress saved successfully.');
            window.history.back();
        })
        .catch((error) => {
            console.error('Error saving progress or updating Report_Status:', error);
            alert('Error saving progress or updating Report_Status. Please try again.');
        });
}


document.addEventListener("DOMContentLoaded", function() {
    const formElements = document.querySelectorAll('#form-print input, #form-print textarea');

    // Assume you want to use the HTML file name as a node under SavedProgress
    const htmlFileName = window.location.pathname.split("/").pop().replace(".html", "");

    // Retrieve saved data from Firebase
    firebase.database().ref(`${FirebasePath}/SavedProgress/${htmlFileName}`).once('value').then((snapshot) => {
        const savedData = snapshot.val();
        if (savedData) {
            formElements.forEach(element => {
                const sanitizedId = sanitizeKey(element.id);
                if (element.type === 'radio') {
                    if (savedData[sanitizedId] === element.value) {
                        element.checked = true;
                    }
                } else {
                    element.value = savedData[sanitizedId] || '';
                }
            });

            // Set the patient name if it's stored in savedData
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement && savedData['patientName']) {
                inputElement.value = savedData['patientName'];
            }

        } else {
            // If no saved data is found, set the formatted patient name
            const inputElement = document.querySelector('input[type="text"]');
            if (inputElement) { // Check if the input element exists
                inputElement.value = formattedPatientName;
            }
        }
    }).catch((error) => {
        console.error('Error loading saved progress:', error);
    });
});



const sanitizedPatientName = sanitizeKey(formattedPatientName);
const sanitizedFirebasePath = FirebasePath.split('/').map(sanitizeKey).join('/');

    var counter = 1;

    function GeneratePdf() {
    var element = document.getElementById("form-print");
    var submitButton = document.getElementById("submitReportButton");
    var saveButton = document.getElementById("saveProgressButton");
    var opt = {
        margin: [0.5, 0, 1, 0],
        filename: 'myfile.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    // Show the overlay with progress bar
    var overlay = document.getElementById("overlay");
    var progressBar = document.getElementById("fileUploadProgress");
    var progressText = document.getElementById("uploadPercentage");

    // Hide the submit button before generating PDF
    saveButton.style.display = "none";
    submitButton.style.display = "none";

    overlay.style.display = "flex"; // Show the overlay
    progressBar.value = 0;
    progressText.textContent = "0%";

    // Generate a PDF Blob
    html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
        var blob = pdf.output('blob');
        var randomName = "DoctorReport-" + generateUniqueId();

        // Upload blob to Firebase Storage
        var uploadTask = firebase.storage().ref(`${FirebasePath}/${randomName}.pdf`).put(blob);
        uploadTask.on('state_changed',
            (snapshot) => {
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBar.value = progress;
                progressText.textContent = Math.round(progress) + "%";
            },
            (error) => {
                console.error('Upload failed', error);
                overlay.style.display = "none"; // Hide the overlay on error
            },
            () => {
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    return firebase.database().ref(`${FirebasePath}`).update({ Dicom_ReportURL: downloadURL });
                })
                .then(() => {
                    // Set the Report_Status to 'Final'
                    return firebase.database().ref(`${FirebasePath}`).update({ Report_Status: 'Final' });
                })
                .then(() => {
                    addReportTimestamp(FirebasePath,doctorName);
                    alert("Report submitted successfully.");
                    overlay.style.display = "none"; // Hide the overlay on success
                    window.location.href = `https://easiofyhealth.netlify.app/DoctorPanel`;
                })
                .catch((error) => {
                    console.error('Error updating database:', error);
                    overlay.style.display = "none"; // Ensure overlay is hidden on database error
                });
            }
        );
    }).finally(function () {
        // Show the submit button after PDF generation process
        submitButton.style.display = "block";
    });
}


    function generateUniqueId() {
        return Date.now();
    }
</script>
    
   <!-- Overlay for Blur Effect -->
   <div id="overlay">
    <!-- Progress Display Container -->
    <div id="uploadProgressContainer">
        <h3>Uploading Report...</h3>
        <progress id="fileUploadProgress" value="0" max="100"></progress>
        <span id="uploadPercentage">0%</span>
    </div>
  </div>
  
  <style>
    /* ... your other styles ... */
  
    #overlay {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
      z-index: 2; /* Sit on top */
      cursor: pointer; /* Add a pointer on hover */
    }
  
    #uploadProgressContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      text-align: center;
      z-index: 2;
    }
  
    progress {
      width: 100%; /* Full width */
      height: 20px; /* Specified height */
    }
  </style>

    </body>
</html>
